<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="styles/all.css" media="all"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
  <script type="text/javascript">
    $.ajaxSetup({
      async: false
    });

    const set_list = ["legend_of_blue_eyes_white_dragon", "metal_raiders", "magic_ruler", "pharaohs_servant", "labyrinth_of_nightmare", "legacy_of_darkness", "pharaonic_guardian", "magicians_force", "dark_crisis", "invasion_of_chaos", "ancient_sanctuary", "soul_of_the_duelist", "rise_of_destiny", "flaming_eternity"];
    var drafted_cards = new Set();
    var number_drafted = 0;

    function get_pack(setname, n){
      var setlist = new Array();
      var set_json;
      $.getJSON("https://ek488.github.io/ygo_limited/set_jsons/".concat(setname).concat(".json"), function(set) {
        set_json = set;
      });

      for (card in set_json.data) {
        setlist.push(set_json.data[card].id);
      }

      var pack_cards = [];
        for (i = 0; i < n; i++) {
          var pack_card = setlist[Math.floor(Math.random() * setlist.length)];
          // Reroll the card if it's already in the pack.
          while (pack_cards.includes(pack_card)) {
            pack_card = setlist[Math.floor(Math.random() * setlist.length)];
          }
          pack_cards.push(pack_card);
        }
        console.log(pack_cards);
        return pack_cards;
    }

    function display_card_image(id, draft=false){
      var x = document.createElement("IMG");
      x.setAttribute("src", "card_images/".concat(id).concat(".jpg"));
      x.setAttribute("alt", id);
      x.setAttribute("height", 312);
      x.setAttribute("width", 210);
      if (draft) {
        x.setAttribute("class", "pack")
        x.setAttribute("onclick", "draft('".concat(id).concat("')"));
        document.body.insertBefore(x, document.getElementById("break"));
      }
      else {
        document.body.appendChild(x);
      }
    }

    function draft(id){
      // Update number of cards drafted
      number_drafted++;
      document.getElementById("deckHeader").innerHTML = "Drafted Cards (".concat(number_drafted.toString()).concat("/87)")

      drafted_cards.add(id);
      display_card_image(id);

      for (pack_card_img of document.getElementsByClassName("pack")) {
        pack_card_img.setAttribute("hidden", "");
      }

      if (number_drafted < 87) {
        pack_cards = get_pack(set_list[number_drafted], 9);
          for (pack_card of pack_cards) {
            display_card_image(pack_card, true);
          }
      }
    };

    var pack_cards = get_pack(set_list[number_drafted], 9);
    for (pack_card of pack_cards) {
      display_card_image(pack_card, true);
    }

  </script>
  
  <br id="break"></br>
  <h1 id="deckHeader">Drafted Cards (0/87)</h1>

</body>

</html>
